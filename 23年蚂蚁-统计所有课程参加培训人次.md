**题目来源：** https://www.nowcoder.com/practice/98aad5807cf34a3b960cc8a70ce03f53?tpId=375&sourceUrl=%2Fexam%2Foj%3FquestionJobId%3D2%26subTabName%3Donline_coding_page&difficulty=&judgeStatus=&tags=&title=&gioEnter=menu  
2025年12月7日

## 一、问题背景与目标
在 `cultivate_tb` 表中，`course` 字段以逗号 `,` 分隔，表示一个员工参加的多个课程名称，例如：

- "Python,SQL,Excel"
- "AI,Data Mining"
- "Excel"

现在的目标是 **统计所有非空 course 字段中，一共包含多少个课程（计数总和）**。

因为每条记录可能有多个课程，因此需要通过字符串处理来计算每条记录的课程数量，再对所有记录求和。

---

## 二、最终 SQL

```sql
select
    sum(
        length(course) - length(replace(course, ',', '')) + 1
    ) AS staff_nums
from cultivate_tb
where course is not null;
```

## 三、解题思路

1. **识别逗号分隔的数量含义**  
   一个字符串中，如果有 n 个逗号，则表示有 n + 1 个课程。  
   例如："A,B,C" → 2 个逗号 → 3 个课程。

2. **计算单条记录课程数量**  
   使用字符串长度差来计算逗号出现次数：  
   - `length(course)`：原字符串长度  
   - `length(replace(course, ',', ''))`：去掉逗号后的长度  
   - 两者相减即可得到逗号数量  

   最终课程数量计算式：  
   `length(course) - length(replace(course, ',', '')) + 1`

3. **对所有记录求和**  
   对每条记录的课程数量进行 `sum()` 统计，得到所有课程数量总和。

4. **过滤掉 null 的记录**  
   `where course is not null`

## 四、相关知识点

### 1. `REPLACE(str, from_str, to_str)`
用于替换字符串，在本题用于删除所有逗号，便于计算逗号数量。

### 2. `LENGTH(str)`
获取字符串长度，用来比较替换前后的长度差异。

### 3. 逗号分隔计数技巧
对于一个用逗号分隔的列表：  
课程数 = **逗号数 + 1**

这是常见的字符串计数技巧。

### 4. `SUM()` 聚合函数
用于对每条记录的课程数值求和，得到全表的总课程数量。

