**题目来源：** https://www.nowcoder.com/practice/22633632da344e2492973ecf555e10c9?tpId=375&tqId=10497698&sourceUrl=%2Fexam%2Foj  
**做题日期：** 2025年12月3日


# 问题背景与目标
在贷后风险分析中，通常需要按客户的某些特征维度（如还款能力、职业、地区等）来分析不同分组的逾期情况差异。本题使用两个数据表：

- **loan_tb**：包含贷款及逾期信息（overdue_days）
- **customer_tb**：包含客户信息（pay_ability）

**目标：**  
按照客户的 **pay_ability（还款能力）** 进行分组，计算每组的 **逾期率（overdue_ratio）**，并按逾期率从高到低排序。

逾期率公式：

\[
逾期率 = \frac{逾期用户数}{总用户数} \times 100\%
\]

---

# 最终SQL
```sql
select
    c.pay_ability,
    concat(round(sum(case when l.overdue_days is not null then 1 else 0 end)/count(*)*100,1),'%') as overdue_ratio
from loan_tb l join customer_tb c on l.customer_id = c.customer_id
group by c.pay_ability
order by overdue_ratio desc;
```

# 解题思路
1. 通过 customer_id 将 loan_tb 与 customer_tb 进行关联，得到每笔借款对应的客户还款能力。
2. 使用 CASE WHEN 判断 overdue_days 是否为 NULL，如果不是 NULL 就计为逾期。
3. 对逾期笔数进行 sum，再除以总笔数 count(*) 得到逾期率。
4. 使用 round(...,1) 保留 1 位小数，再用 concat 拼接百分号。
5. 按 pay_ability 分组统计不同类型客户的逾期率。
6. 最后根据逾期率从高到低排序。

# 相关知识点
- **JOIN**：通过 customer_id 将两张表关联。
- **CASE WHEN**：用于统计满足条件的数据笔数。
- **SUM 与 COUNT**：常见的聚合函数，用于计算逾期数量与总样本数。
- **ROUND()**：对数值进行四舍五入，保留指定小数位。
- **CONCAT()**：字符串拼接，这里用于拼接百分号。
- **GROUP BY**：按 pay_ability 对客户进行分类统计。
- **ORDER BY**：根据计算出的逾期率进行排序。
