**题目来源：** https://www.nowcoder.com/practice/ed04f148b63e469e8f62e051d06a46f5?tpId=375&tqId=10858424&sourceUrl=%2Fexam%2Foj%3Fpage%3D1%26tab%3DSQL%25E7%25AF%2587%26topicId%3D375  
**做题日期：** 2025年12月5日

## 一、问题背景与目标
公司希望统计客户 **Tom** 在 **2023 年** 的所有 **类型为 1 的交易**（`t_type = 1`），并按 **月份** 汇总其交易总金额。最终需要输出每个月份以及对应的交易总额，按时间顺序排序。

目标：  
- 按月汇总 Tom 的交易金额  
- 仅统计年份为 2023、交易类型为 1 的记录  
- 输出格式示例：`2023-01 | 1350.5`

---

## 二、最终 SQL

```sql
select 
    date_format(t.t_time,'%Y-%m') as time,
    round(sum(t.t_amount),1) as total
from trade t
join customer c on t.t_cus = c.c_id
where 
    c.c_name = 'Tom'
    and year(t.t_time) = 2023
    and t.t_type = 1
group by time
order by time;
```

## 三、解题思路  
1. 确定筛选条件  
- 客户名称：c_name = 'Tom'  
- 交易年份：YEAR(t_time) = 2023  
- 交易类型：t_type = 1  
2. 选择合适的分组字段  
- 使用 date_format(t_time, '%Y-%m') 将日期转成“年-月”格式，用于按月分组。  
3. 金额聚合  
- 使用 SUM(t_amount) 对每个月的交易金额求和，再用 ROUND(...,1) 保留一位小数。  
4. 排序输出  
- 对时间字段进行升序排序，确保结果按月份顺序展示。  


## 四、相关知识点  
1. date_format() 日期格式化  
- %Y：四位年份（2023）  
- %y：两位年份（23）  
- %m：月份（01–12）  
→ 本题必须用 %Y-%m，否则会出现年份混淆。  

2. YEAR() 提取年份  
- YEAR(t_time) 用于从日期字段中提取年份部分，常用来做年度过滤。  

3. 聚合函数  
- SUM()：求总和  
- ROUND(value, decimals)：四舍五入保留小数位  

4. SQL 分组与排序  
- GROUP BY 对相同月份的数据聚合  
- ORDER BY time 按月份顺序输出结果  
